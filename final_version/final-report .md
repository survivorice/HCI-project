# 语音自主定位方法——结题报告
----
组长：张啸 516030910467   
组员：王力帆 516030910438    汤志彪 516030910435


## 应用背景
   
  定位是智能交互系统中非常重要的技术环节。传统的定位技术基本都是通过各种传感（红外、蓝牙、视觉、超声波等）技术对目标对象进行跟踪定位。
近年来出现了利用SLAM等技术进行对象自主定位的方法。在SLAM理论中，第一个问题称为定位 (Localization)，第二个称为建图 (Mapping)，第三个则是随后的路径规划。然而利用SLAM进行定位时构建场景时耗时较长，且需要比较多的资源。

## 主要目标

  本项目希望通过用语音识别交互的方式进行对象的粗定位，缩小SLAM搜索空间提高精确定位效率。本质上的初衷是为了对SLAM技术的第一步定位进行优化。


## HCI用户分析

### 用户需求
   - 反应速度快
      * 用户输入语音后能快速的做出响应，返回可能的结果或目标
   - 返回的结果识别度高。
      * 即返回时的字体大小要合适，同时语义要让用户能够理解。
   - 语音识别更加灵活
      * 可识别的语音要尽可能的贴合实际，而不是需要用户硬性的按照固定的格式才可识别。
        即尽量减少用户得不到结果或者得到错误结果的可能。
   - 定位尽可能精准
      * 基本要求，定位准确
   - 界面简单，易于学习使用
      * 操作方便简单容易上手，贴合大众人群实际， 能在群众中推广
   

## 设计方案
    1.打开应用；
    2.用户输入语音，应用进行识别，返回识别出的字符串
    3.应用分析音频，提取其中的关键字
    1. a）若提取出关键字，用户将关键字与系统库进行比对
       b）若提取不出关键字，提示用户没有结果，返回第2步
    2. a）对比结果，应用返回可能的结果
       b）对比结果为无，跳转到页面列出可能的结果供用户点击选择
    3. 对目标区域高亮显示，反馈给用户
    4. 如果显示得到结果不正确，用户可以点击“可能的更多结果”进行重新选择

## 创新点
        
1. 组合Unity 3D与讯飞语音识别功能，在语音分析模块可以尝试利用算法提高分析效率和准确度，提高用户体验质量


## 技术方案

### 语音识别

在Unity 3D中使用讯飞语音进行对于音频识别，现已测试讯飞语音的识别准确度，发现同一句话在语速、语调或口语不同的情况下可能返回不同的结果，需要研究算法提高识别准确度。

### 语音分析
   
对语音识别返回的字符串进行分析，提取keyword。对比预设的keyword。如何提取keyword、如何设计keyword贴合日常语句以及如何使keyword有较好的覆盖率是现阶段的难点。


## 技术细节
### 语音识别功能
      通过讯飞官网下载SDK，同时添加语音听写AI能力（添加新服务）。
      在Eclipse中导入项目并进行相关配置工作。
      在unity中导入上述目标并且编写Xunfei Manager脚本。
      已在安卓环境下有初步的GUI界面，可以用于测试。
      
### 语音识别测试
   
   测试用例|结果|预测原因
   --|:--:|:--:
   3308|正确| 
   东面|正确| 
   南面|正确|
   西方|正确|
   北部|正确|
   走廊头|正确|
   楼梯口|正确|
   两楼左转|正确（2楼左转）|
   东边走廊|错误|测试时离话筒过远，再次识别成功
   我在两楼走廊处|正确|
   我在三二零八门口|正确|
   应该是三二零八吧|错误|输出结果“应该是32088”，预测“吧”这种语气词若是跟在多个数字后面会被识别成数字
   我旁边是走廊|正确|
   应该————是在3108|不影响关键词|“应该”后故意模仿人思考，识别结果为“嗯”，不影响数字识别
   3208|错误|在语速过快的时候，导致其中一个数字被吃掉
   
         
   总结：
      - 对于"3308"这种带有数字的输入能做到正确识别
      - 对于“东南西北里外”等方位词能够正确识别
      - 对于"楼梯口""走廊"等特殊地点能够正确识别
      - 语速过快可能导致识别偏差
      - 解决方案：在GUI界面反馈时给予用户选项
      - 有些词相对于同音字没有这么通用会导致有误差
      - 解决方案：将同音近义词纳入同一个标签

   之后通过对测试用例的分析进行关键词的识别提取分析。
      
     
### 模型导入与处理
   
#### 对问题的发现和解决
   导入模型为软件学院大楼的模型，与预期设想的不太一样，软件学院大楼模型为一个整体，而并非由小部件组合而成，这使得原来想利用unity中tag来进行辨别的方法无法实现
   
   
   应对该问题，决定利用一个被预制为透明的cube来标识人物所处位置
   
   
   经过搜索边缘高亮，选中了两个Unity Assert Store中的插件，分别是Outline Effect和Highlighting System
   
   
   实验后发现Outline Effect有如下问题：
   - 边缘有些过于粗糙
   - 当cube的alpha通道置为0时，边缘高亮效果会消失
   
   
   而Highlight System对比Outline Effect则优异的多，效果也符合全体组员的预期
   
   
   因此，处理边缘高亮决定使用Highlighting System
       
#### 处理流程
   - 在摄像机上添加Highlighing Renderer组件
   - 为HighLight（目标cube），添加Highlighter组件
   - 在收到tag（目标位置）后，根据代码中的信息变化HighLight的transform信息，从而从肉眼效果上体现出高亮
      
  ![高亮效果图](https://github.com/survivorice/HCI-project/blob/master/picture/highlightSystemdemo.jpg)
  
#### 一些不足
  - 模型除了标准的room外，有类似半圆的平台，而预设的cube并不能完美描绘出外轮廓
  - transform信息需要手动调整，期望在之后想出合适的自动化方式

### 语音分析

#### 关键字提取
   1.定义了一个存放关键字关键字的hashset，里面初始定义了几个关键字，作为库用于语音关键字的对比。

   2.得到语音识别结果，第一步提取里面的数字作为关键词；

   3.通过遍历语音识别语句，判断里面的字是否存在于关键词库，如果是则提取为关键词；

#### 位置定位
   4.得到1，2步的关键词，通过数字或通过一些特定的标志物进行确定房间，在房间的基础上通过其他关键词进行偏差位置；

   5.如果通过关键词无法点位大致房间位置，如数字房间号不存在等，场景跳转到一个列出可能的结果的界面，用户可以点击选择或直接返回选择重新输入语音。

   6.如果定位结果不准确，用户可以点击“更多可能结果”根据具体的场景照片进行重定位



   

### Android app的界面开发

#### app应用中模型的放缩与旋转
- 为了让用户更清晰的知道了解自己所处的位置，在Android app中需要有对模型进行放缩的功能。
  
在触摸屏上，如果只有单接触点，接触点通过上下移动，对模型进行上下左右旋转
在触摸屏上，如果有2个接触点，通过改变接触点之间的距离，对模型进行放缩

#### app应用中添加语音识别
   在app应用中添加输入语音按钮与输出文本框，对按钮事件进行绑定
![应用界面](https://github.com/survivorice/HCI-project/blob/master/picture/app1.3.jpg)
#### app应用添加退出事件
   添加退出app事件

#### 生成导出现版本的apk包
   

### GUI的美化以及更加符合HCI思想
   
   
根据辨认的结果，在UI界面显示定位结果文字说明。APP界面多场景设计，界面的美观优化


## 实验验证

经过如下实验验证该应用的可使用性

测试用例|测试内容|目的
   :--:|:--:|:--:
   1 | 模型放缩测试|操纵模型
   2 | 模型拖动测试|操纵模型
   3 | 输入“3207”|无干扰
   4 | 输入“我在3206里面”|有略微干扰
   5 | 输入“我在3203外面” | 里外测试
   6 | 输入”走廊” | 测试默认值
   7 | 输入“我在3201走廊” | 测试不同位置
   8 | 输入“207” | 模糊字搜索
   9 | 输入“桌子” | 场景内特有物体检测
   10 | 输入“楼梯” | 场景内特有物体检测
   11 | 输入”我在3207楼梯“ | 场景内特有物体检测
   12 | 输入”我在楼梯，旁边有圆环“ | 有一定的修饰词语
   13 | 输入”今天天气真好“ | 测试无关话语的反应


## 环境配置
   在安卓手机上下载在Version2.apk的文件，安装，并给应用麦克风权限。


## 参考
- 讯飞SDK，[xunfei](https://www.xfyun.cn/)
- 讯飞与Unity结合，[xunfei&unity](https://blog.csdn.net/qq_15267341/article/details/52074225?tdsourcetag=s_pctim_aiomsg)




## 项目分工
- 张啸：语音识别测试，
- 王力帆：语音识别，模型加载及处理，
- 汤志彪：语音分析，安卓端app的开发
     



